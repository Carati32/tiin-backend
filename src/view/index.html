<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevHub</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="../style/style.css">
</head>

<body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
            <a class="navbar-brand" style="font-weight: bold;" href="#">DevHub</a>
            </button>
            <div class="collapse navbar-collapse navbar-central" id="navbarSupportedContent">
                <ul class="navbar-nav mx-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link " aria-current="page" href="#">Dasboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Projetos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Comunidade</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Recursos</a>
                    </li>
                </ul>
                <img src="../img/image.png" alt="" style="width: 50px;">
            </div>
        </div>
    </nav>
    <div class="layout">

        <div class="card card-esquerdo" style="width: 18rem;">
            <div class="card-body">
                <div class="topo-card-esquerdo">
                    <img src="../img/image.png" class="card-img-top" alt="...">
                    <h5 class="card-title">Nome</h5>
                    <h6 class="card-subtitle mb-2 text-body-secondary">Fun칞칚o</h6>
                </div>
                <p class="card-text">Qyd. logs:22</p>
                <p class="card-text">Total de Bugs:12</p>
                <p class="card-text">Horas trabalgas:14</p>

                <h4>Filtros</h4>
                <label><input type="checkbox" checked /> Programa칞칚o</label><br />
                <label><input type="checkbox" /> Arte 3D/2D</label><br />
                <label><input type="checkbox" /> Sound Design</label>
            </div>
        </div>



        <div class="card card-central" id="container-logs">
    
<button id="btn-criar-log">+Criar Novo Log</button>
            <!-- Formul치rio para criar log -->
            <div id="form-criar-log" style="display:none; margin-top:10px;">
                <label>Categoria:</label>
                <select id="categoria">
                    <option value="Programa칞칚o">Programa칞칚o</option>
                    <option value="Arte 3D/2D">Arte 3D/2D</option>
                    <option value="Sound Design">Sound Design</option>
                </select><br><br>

                <label>Horas trabalhadas:</label>
                <input type="number" id="horas_trabalhadas" min="0"><br><br>

                <label>Linhas de c칩digo:</label>
                <input type="number" id="linhas_codigo" min="0"><br><br>

                <label>Bugs corrigidos:</label>
                <input type="number" id="bugs_corrigidos" min="0"><br><br>

                <button id="submit-log">Criar Log</button>
            </div>
            <div class="card card-central" id="container-logs">
</div>
            <div class="card-body">
                <div class="card-comments">
                    <div class="infos-user">
                        <img src="../img/image.png" alt="foto do usuario">
                        <div class="texto-user">
                            <p>nome</p>
                            <p>tempo da resposta</p>
                        </div>
                        <p id="filtro">filtro</p>
                    </div>
                    <div class="card-dentro-central">
                        <h4>titulo</h4>
                        <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Ratione illo ab at? Itaque,
                            repellendus. Officiis dolorum perferendis, vitae doloremque soluta quos nemo eveniet
                            repudiandae! Veritatis facere temporibus enim rem molestias.</p>
                        <div>
                            <div class="hlb">
                                <p>29 horas</p>
                                <p>20 linhas</p>
                                <p>21 bugs Corrigidos</p>
                            </div>
                            <div class="likes-comentarios">
                                <button class="btn-like" data-logid="1" data-userid="1">0 游녨</button>
                                <p>12 游꺍</p>
                            </div>
                        </div>
                        <label for="postar-comentario"></label>
                        <input type="text" id="postar-comentario" placeholder="Escreva um comentario.">
                        <button>Enviar</button>

                    </div>
                </div>
            </div>


        </div>

        <div class="card card-direito">
            <div class="card-body">
                <h5 class="card-title">Atividade recente</h5>
                <div class="card-direito-usuario">
                    <img src="../img/image.png" alt="usuario">
                    <p>Nome</p>
                </div>
                <div class="card-direito-usuario">
                    <img src="../img/image.png" alt="usuario">
                    <p>Nome</p>
                </div>
                <h5>Desenvolvedores em Destaque</h5>
                <div class="card-direito-usuario">
                    <img src="../img/image.png" alt="usuario">
                    <p>Nome</p>
                </div>
                <div class="card-direito-usuario">
                    <img src="../img/image.png" alt="usuario">
                    <p>Nome</p>
                </div>
            </div>
        </div>
    </div>
    <script>
const userId = 1; // ID do usu치rio logado
const userName = "Nome"; // Nome do usu치rio logado

// Mostra/oculta o formul치rio
document.getElementById("btn-criar-log").addEventListener("click", () => {
    const form = document.getElementById("form-criar-log");
    form.style.display = form.style.display === "none" ? "block" : "none";
});

// Fun칞칚o para criar o card do log
function criarCardLog(log) {
    card.innerHTML = `
<div class="card-comments">
    <div class="infos-user">
        <img src="../img/image.png" alt="foto do usuario">
        <div class="texto-user">
            <p>${userName}</p>
            <p>${new Date().toLocaleString()}</p>
        </div>
        <p id="filtro">${log.categoria}</p>
    </div>
    <div class="card-dentro-central">
        <h4>${log.titulo || 'T칤tulo do Log'}</h4>
        <p>${log.descricao || 'Horas trabalhadas, linhas de c칩digo e bugs corrigidos do log criado.'}</p>
        <div class="hlb">
            <p>${log.horas_trabalhadas} horas</p>
            <p>${log.linhas_codigo} linhas</p>
            <p>${log.bugs_corrigidos} bugs Corrigidos</p>
        </div>
        <div class="likes-comentarios">
            <button class="btn-like" data-logid="${log.id}" data-userid="${userId}">0 游녨</button>
            <p>0 游꺍</p>
        </div>
        <input type="text" placeholder="Escreva um comentario.">
        <button>Enviar</button>
    </div>
</div>
`;
}

// Evento do formul치rio de cria칞칚o de log
document.getElementById("submit-log").addEventListener("click", async () => {
    const categoria = document.getElementById("categoria").value;
    const horas_trabalhadas = Number(document.getElementById("horas_trabalhadas").value);
    const linhas_codigo = Number(document.getElementById("linhas_codigo").value);
    const bugs_corrigidos = Number(document.getElementById("bugs_corrigidos").value);

    // Valida칞칚o b치sica
    const categoriasValidas = ["Programa칞칚o", "Arte 3D/2D", "Sound Design"];
    if (!categoriasValidas.includes(categoria) || isNaN(horas_trabalhadas) || isNaN(linhas_codigo) || isNaN(bugs_corrigidos)) {
        alert("Preencha todos os campos corretamente e selecione uma categoria v치lida!");
        return;
    }

    try {
        const response = await fetch("http://localhost:3000/logs", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                id_user: userId,
                categoria,
                horas_trabalhadas,
                linhas_codigo,
                bugs_corrigidos
            })
        });

        const novoLog = await response.json();
        criarCardLog(novoLog);

        // Limpa formul치rio e oculta
        document.getElementById("form-criar-log").style.display = "none";
        document.getElementById("horas_trabalhadas").value = "";
        document.getElementById("linhas_codigo").value = "";
        document.getElementById("bugs_corrigidos").value = "";

    } catch (error) {
        console.error("Erro ao criar log:", error);
        alert("Erro ao criar log!");
    }
});

// Fun칞칚o de like
async function atualizarLikeBotao(botao) {
    const log_id = Number(botao.dataset.logid);
    const user_id = Number(botao.dataset.userid);

    try {
        const respToggle = await fetch("http://localhost:3000/likes", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ log_id, user_id }),
        });

        const data = await respToggle.json();
        console.log(data);

        // Atualiza contador de likes
        const respCount = await fetch(`http://localhost:3000/logs`);
        const logs = await respCount.json();
        const logAtual = logs.find(l => l.id === log_id);
        if (logAtual) botao.innerText = `${logAtual.likes} 游녨`;

        botao.style.color = data.message.includes("adicionado") ? "blue" : "black";

    } catch (error) {
        console.error("Erro ao alternar like:", error);
    }
}

// Inicializa likes dos cards existentes
async function inicializarLikes() {
    const botoes = document.querySelectorAll(".btn-like");
    const respLogs = await fetch("http://localhost:3000/logs");
    const logs = await respLogs.json();

    botoes.forEach(botao => {
        const log_id = Number(botao.dataset.logid);
        const logAtual = logs.find(l => l.id === log_id);
        if (logAtual) botao.innerText = `${logAtual.likes} 游녨`;
    });
}
document.addEventListener("DOMContentLoaded", inicializarLikes);
</script>
</body>

</html>